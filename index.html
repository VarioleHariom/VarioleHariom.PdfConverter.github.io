<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OM PDF - Next-Gen Image to PDF Converter</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter for a clean, modern look -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- PDF-lib for client-side PDF generation -->
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    
    <!-- Feather Icons for a sleek icon set -->
    <script src="https://unpkg.com/feather-icons"></script>

    <style>
        /* Custom styles to complement Tailwind */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0a0a; /* A very dark gray for a premium feel */
            color: #f0f0f0;
        }

        /* Custom scrollbar for a more integrated look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        ::-webkit-scrollbar-thumb {
            background: #4a4a4a;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #5a5a5a;
        }

        /* Styling for the file input button */
        .file-input-button {
            cursor: pointer;
        }

        /* Animation for items fading in */
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        
        /* Draggable item styling */
        .dragging {
            opacity: 0.5;
            background: #2d3748;
        }
        
        /* Glassmorphism effect for the modal */
        .glass-modal {
            background: rgba(26, 26, 26, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="antialiased">

    <div id="app" class="min-h-screen flex flex-col p-4 md:p-8">

        <!-- Header Section -->
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">
                OM PDF Design
            </h1>
            <p class="text-gray-400 mt-2 text-lg">Transform your images into elegant, professional documents.</p>
        </header>

        <!-- Main Controls -->
        <div class="w-full max-w-6xl mx-auto flex flex-col md:flex-row items-center justify-between gap-4 mb-6 sticky top-4 z-20 p-4 rounded-xl glass-modal">
            <div>
                <label for="fileInput" class="file-input-button inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg shadow-lg transition-all duration-300 transform hover:scale-105">
                    <i data-feather="plus-circle"></i>
                    <span>Add Images</span>
                </label>
                <input type="file" id="fileInput" multiple accept="image/*" class="hidden">
            </div>
            <div id="actionButtons" class="flex items-center gap-3 md:gap-4 opacity-0 transition-opacity duration-500">
                <button id="smartArrangeBtn" title="Smart Auto-Arrange" class="bg-gray-700 hover:bg-gray-600 text-white font-medium p-3 rounded-lg transition-colors duration-300">
                    <i data-feather="layout"></i>
                </button>
                <button id="magicWandBtn" title="Apply Aesthetic Filter" class="bg-gray-700 hover:bg-gray-600 text-white font-medium p-3 rounded-lg transition-colors duration-300">
                    <i data-feather="wand"></i>
                </button>
                 <button id="clearAllBtn" title="Clear All Images" class="bg-red-800 hover:bg-red-700 text-white font-medium p-3 rounded-lg transition-colors duration-300">
                    <i data-feather="trash-2"></i>
                </button>
                <button id="generatePdfBtn" class="inline-flex items-center gap-2 bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-5 rounded-lg shadow-md transition-all duration-300 transform hover:scale-105">
                    <i data-feather="file-text"></i>
                    <span>Generate PDF</span>
                </button>
            </div>
        </div>

        <!-- Image Canvas Area -->
        <main id="imageCanvas" class="w-full max-w-6xl mx-auto flex-grow rounded-2xl bg-gray-900/50 border-2 border-dashed border-gray-700 p-6 transition-colors duration-300">
            <div id="placeholder" class="h-full flex flex-col items-center justify-center text-gray-500">
                <i data-feather="image" class="w-24 h-24 mb-4"></i>
                <h3 class="text-2xl font-semibold">Drop your images here</h3>
                <p class="text-lg">or click 'Add Images' to begin your masterpiece</p>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="text-center text-gray-500 mt-8">
            <p>Designed & Developed by Gemini</p>
        </footer>

    </div>

    <!-- Processing Modal -->
    <div id="processingModal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
        <div class="absolute inset-0 bg-black/50"></div>
        <div class="glass-modal rounded-2xl p-8 flex flex-col items-center gap-4 text-white shadow-2xl">
            <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12 mb-4 animate-spin" style="border-top-color: #8b5cf6;"></div>
            <h3 id="modalText" class="text-xl font-semibold">Generating PDF...</h3>
            <p id="modalSubText" class="text-gray-300">Please wait while we craft your document.</p>
        </div>
    </div>

    <script>
        // --- DOM Element Selection ---
        const fileInput = document.getElementById('fileInput');
        const imageCanvas = document.getElementById('imageCanvas');
        const placeholder = document.getElementById('placeholder');
        const actionButtons = document.getElementById('actionButtons');
        const generatePdfBtn = document.getElementById('generatePdfBtn');
        const smartArrangeBtn = document.getElementById('smartArrangeBtn');
        const magicWandBtn = document.getElementById('magicWandBtn');
        const clearAllBtn = document.getElementById('clearAllBtn');
        const processingModal = document.getElementById('processingModal');
        const modalText = document.getElementById('modalText');
        const modalSubText = document.getElementById('modalSubText');

        // --- State Management ---
        let imageFiles = []; // This will be our source of truth
        let magicFilterActive = false;
        let draggedItem = null;

        // --- PDF Library ---
        const { PDFDocument, rgb } = PDFLib;

        // --- Event Listeners ---
        fileInput.addEventListener('change', handleFileSelect);
        generatePdfBtn.addEventListener('click', generatePdf);
        smartArrangeBtn.addEventListener('click', smartArrange);
        magicWandBtn.addEventListener('click', toggleMagicFilter);
        clearAllBtn.addEventListener('click', clearAllImages);
        
        // Drag and Drop Listeners
        imageCanvas.addEventListener('dragover', handleDragOver);
        imageCanvas.addEventListener('dragleave', handleDragLeave);
        imageCanvas.addEventListener('drop', handleDrop);


        // --- UI Update Functions ---
        function updateUI() {
            if (imageFiles.length > 0) {
                placeholder.classList.add('hidden');
                actionButtons.classList.remove('opacity-0');
                imageCanvas.classList.remove('items-center', 'justify-center');
                imageCanvas.classList.add('grid', 'grid-cols-2', 'md:grid-cols-3', 'lg:grid-cols-4', 'xl:grid-cols-5', 'gap-4');
            } else {
                placeholder.classList.remove('hidden');
                actionButtons.classList.add('opacity-0');
                imageCanvas.classList.remove('grid', 'grid-cols-2', 'md:grid-cols-3', 'lg:grid-cols-4', 'xl:grid-cols-5', 'gap-4');
                imageCanvas.classList.add('items-center', 'justify-center');
                magicFilterActive = false;
                magicWandBtn.classList.remove('bg-purple-600');
            }
            feather.replace(); // Refresh icons
        }

        function renderCanvas() {
            imageCanvas.innerHTML = ''; // Clear the canvas
            imageFiles.forEach((fileData, index) => {
                const wrapper = createImageElement(fileData, index);
                imageCanvas.appendChild(wrapper);
            });
            updateUI();
        }

        // --- Core Functionality ---

        function handleFileSelect(event) {
            const files = event.target.files;
            processFiles(files);
        }

        function processFiles(files) {
            if (files.length === 0) return;
            
            Array.from(files).forEach(file => {
                if (!file.type.startsWith('image/')) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                         imageFiles.push({
                            file: file,
                            dataUrl: e.target.result,
                            name: file.name,
                            id: Date.now() + Math.random(),
                            width: img.width,
                            height: img.height,
                            aspectRatio: img.width / img.height
                        });
                        renderCanvas(); // Re-render after each file is processed
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
            fileInput.value = ''; // Reset input
        }

        function createImageElement(fileData, index) {
            const wrapper = document.createElement('div');
            wrapper.className = 'fade-in group relative aspect-w-1 aspect-h-1 bg-gray-800 rounded-lg overflow-hidden shadow-lg cursor-grab transition-all duration-300';
            wrapper.setAttribute('draggable', true);
            wrapper.dataset.index = index;

            const img = document.createElement('img');
            img.src = fileData.dataUrl;
            img.className = 'object-cover w-full h-full transition-transform duration-300 group-hover:scale-110';
            if (magicFilterActive) {
                img.style.filter = 'grayscale(0.5) contrast(1.1) brightness(0.95)';
            }
            
            const overlay = document.createElement('div');
            overlay.className = 'absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col justify-end p-2';

            const fileName = document.createElement('p');
            fileName.className = 'text-white text-xs font-medium truncate';
            fileName.textContent = fileData.name;

            const removeBtn = document.createElement('button');
            removeBtn.className = 'absolute top-2 right-2 bg-red-600/70 hover:bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center transition-all duration-300 transform scale-0 group-hover:scale-100';
            removeBtn.innerHTML = '<i data-feather="x" class="w-4 h-4"></i>';
            removeBtn.onclick = (e) => {
                e.stopPropagation();
                removeImage(index);
            };

            overlay.appendChild(fileName);
            wrapper.appendChild(img);
            wrapper.appendChild(overlay);
            wrapper.appendChild(removeBtn);
            
            // Drag and Drop event listeners for each item
            wrapper.addEventListener('dragstart', handleDragStart);
            wrapper.addEventListener('dragend', handleDragEnd);
            wrapper.addEventListener('dragenter', handleDragEnter);
            wrapper.addEventListener('dragleave', handleDragLeaveItem);
            wrapper.addEventListener('drop', handleItemDrop);


            return wrapper;
        }

        function removeImage(index) {
            imageFiles.splice(index, 1);
            renderCanvas();
        }
        
        function clearAllImages() {
            if (imageFiles.length > 0 && confirm('Are you sure you want to clear all images?')) {
                imageFiles = [];
                renderCanvas();
            }
        }

        async function generatePdf() {
            if (imageFiles.length === 0) return;

            processingModal.classList.remove('hidden');
            modalText.textContent = 'Initializing PDF...';
            modalSubText.textContent = 'Please wait while we prepare your document.';

            try {
                const pdfDoc = await PDFDocument.create();

                for (let i = 0; i < imageFiles.length; i++) {
                    const fileData = imageFiles[i];
                    modalText.textContent = `Processing image ${i + 1} of ${imageFiles.length}`;
                    modalSubText.textContent = fileData.name;
                    
                    const imageBytes = await fetch(fileData.dataUrl).then(res => res.arrayBuffer());

                    let image;
                    if (fileData.file.type === 'image/png') {
                        image = await pdfDoc.embedPng(imageBytes);
                    } else {
                        image = await pdfDoc.embedJpg(imageBytes);
                    }
                    
                    // If magic filter is on, apply it via a canvas
                    if (magicFilterActive) {
                        const tempCanvas = document.createElement('canvas');
                        const ctx = tempCanvas.getContext('2d');
                        tempCanvas.width = image.width;
                        tempCanvas.height = image.height;
                        ctx.filter = 'grayscale(0.5) contrast(1.1) brightness(0.95)';
                        ctx.drawImage(await createImageBitmap(fileData.file), 0, 0);
                        const filteredImageBytes = await fetch(tempCanvas.toDataURL('image/jpeg', 0.9)).then(res => res.arrayBuffer());
                        image = await pdfDoc.embedJpg(filteredImageBytes);
                    }

                    const page = pdfDoc.addPage([image.width, image.height]);
                    page.drawImage(image, {
                        x: 0,
                        y: 0,
                        width: page.getWidth(),
                        height: page.getHeight(),
                    });
                }

                modalText.textContent = 'Finalizing your PDF...';
                modalSubText.textContent = 'Almost there!';
                const pdfBytes = await pdfDoc.save();

                const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                link.download = `Aether-PDF-Export-${timestamp}.pdf`;
                link.click();
                URL.revokeObjectURL(link.href);

            } catch (error) {
                console.error("Error generating PDF:", error);
                modalText.textContent = 'An Error Occurred';
                modalSubText.textContent = 'Could not generate the PDF. Please try again.';
                setTimeout(() => processingModal.classList.add('hidden'), 3000);
                return;
            }

            processingModal.classList.add('hidden');
        }

        // --- Unique Features ---
        function smartArrange() {
            if (imageFiles.length < 2) return;
            // Sorts by aspect ratio: landscape -> square -> portrait
            imageFiles.sort((a, b) => b.aspectRatio - a.aspectRatio);
            renderCanvas();
        }

        function toggleMagicFilter() {
            magicFilterActive = !magicFilterActive;
            magicWandBtn.classList.toggle('bg-purple-600', magicFilterActive);
            renderCanvas();
        }
        
        // --- Drag and Drop Handlers ---
        
        // For the main canvas area (file drop)
        function handleDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
            imageCanvas.classList.add('border-blue-500', 'bg-gray-800');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.stopPropagation();
            imageCanvas.classList.remove('border-blue-500', 'bg-gray-800');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            imageCanvas.classList.remove('border-blue-500', 'bg-gray-800');
            const files = e.dataTransfer.files;
            processFiles(files);
        }

        // For reordering items
        function handleDragStart(e) {
            draggedItem = this;
            setTimeout(() => {
                this.classList.add('dragging');
            }, 0);
        }
        
        function handleDragEnd(e) {
            setTimeout(() => {
                if(draggedItem) {
                    draggedItem.classList.remove('dragging');
                }
                draggedItem = null;
            }, 0);
        }
        
        function handleDragEnter(e) {
            e.preventDefault();
            if (this !== draggedItem) {
                 // Simple visual feedback can be added here if desired
            }
        }
        
        function handleDragLeaveItem(e) {
            // Simple visual feedback can be removed here
        }
        
        function handleItemDrop(e) {
            e.stopPropagation();
            if (draggedItem !== this) {
                const fromIndex = parseInt(draggedItem.dataset.index);
                const toIndex = parseInt(this.dataset.index);
                
                // Reorder the array
                const [movedItem] = imageFiles.splice(fromIndex, 1);
                imageFiles.splice(toIndex, 0, movedItem);

                // Re-render the entire canvas to reflect the new order
                renderCanvas();
            }
        }


        // --- Initial Load ---
        updateUI();
    </script>
</body>
</html>
